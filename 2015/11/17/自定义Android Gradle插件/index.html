<!doctype html>




<html class="theme-next pisces" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Android,打包,gradle," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="上一篇博客介绍到Gradle实践之自定义打包jar+Log开关自动关闭。可以自己定义打包的jar已经不错了，但是还是不够爽，怎么办？自己写一个Plugin！会用轮子，也要会造轮子是不是，我们经常使用到的com.android.library和com.android.application都是Google给我们提供的Gradle插件，里面已经实现了大部分App开发者所需要的功能。Github上面也已">
<meta name="keywords" content="Android,打包,gradle">
<meta property="og:type" content="article">
<meta property="og:title" content="自定义Android Gradle插件">
<meta property="og:url" content="http://unclechen.github.io/2015/11/17/自定义Android Gradle插件/index.html">
<meta property="og:site_name" content="UncleChen的博客">
<meta property="og:description" content="上一篇博客介绍到Gradle实践之自定义打包jar+Log开关自动关闭。可以自己定义打包的jar已经不错了，但是还是不够爽，怎么办？自己写一个Plugin！会用轮子，也要会造轮子是不是，我们经常使用到的com.android.library和com.android.application都是Google给我们提供的Gradle插件，里面已经实现了大部分App开发者所需要的功能。Github上面也已">
<meta property="og:image" content="http://unclechen.github.io/content/images/new-a-plugin-folder.png">
<meta property="og:image" content="http://unclechen.github.io/content/images/new-a-gradle-file.png">
<meta property="og:image" content="http://unclechen.github.io/content/images/open-the-plugin.png">
<meta property="og:image" content="http://unclechen.github.io/content/images/use-your-gradle-wrapper.png">
<meta property="og:image" content="http://unclechen.github.io/content/images/create-folders.png">
<meta property="og:image" content="http://unclechen.github.io/content/images/add-groovy-sdk.png">
<meta property="og:image" content="http://unclechen.github.io/content/images/new-class-folder.png">
<meta property="og:updated_time" content="2017-05-22T10:23:14.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="自定义Android Gradle插件">
<meta name="twitter:description" content="上一篇博客介绍到Gradle实践之自定义打包jar+Log开关自动关闭。可以自己定义打包的jar已经不错了，但是还是不够爽，怎么办？自己写一个Plugin！会用轮子，也要会造轮子是不是，我们经常使用到的com.android.library和com.android.application都是Google给我们提供的Gradle插件，里面已经实现了大部分App开发者所需要的功能。Github上面也已">
<meta name="twitter:image" content="http://unclechen.github.io/content/images/new-a-plugin-folder.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://unclechen.github.io/2015/11/17/自定义Android Gradle插件/"/>





  <title>自定义Android Gradle插件 | UncleChen的博客</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">UncleChen的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://unclechen.github.io/2015/11/17/自定义Android Gradle插件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="unclechen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="UncleChen的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">自定义Android Gradle插件</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-17T08:00:00+08:00">
                2015-11-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>上一篇博客介绍到<a href="http://unclechen.github.io/2015/10/25/Gradle%E5%AE%9E%E8%B7%B5%E4%B9%8B%E6%89%93%E5%8C%85jar+Log%E5%BC%80%E5%85%B3%E8%87%AA%E5%8A%A8%E5%85%B3%E9%97%AD/">Gradle实践之自定义打包jar+Log开关自动关闭</a>。可以自己定义打包的jar已经不错了，但是还是不够爽，怎么办？自己写一个Plugin！会用轮子，也要会造轮子是不是，我们经常使用到的<code>com.android.library</code>和<code>com.android.application</code>都是Google给我们提供的Gradle插件，里面已经实现了大部分App开发者所需要的功能。Github上面也已经有很多gradle插件，但是如果我们是程序猿，我们总是可以有需求是人家的Plugin无法满足的，那好吧，我们自己写个插件。</p>
<a id="more"></a>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="开发环境（以Win7为例）"><a href="#开发环境（以Win7为例）" class="headerlink" title="开发环境（以Win7为例）"></a>开发环境（以Win7为例）</h2><ul>
<li><p>IDE开发环境：我这篇例子就用Android Stuido来写的，使用AS写会有一点点的奇怪，因为AS默认新建的都是Android工程，可是！用它来写一个Gradle Plugin并没有任何问题！但实际上Gradle不仅仅可以给Android项目使用。所以我推荐大家去体验一下JetBrains家的Java IDE——<a href="https://www.jetbrains.com/idea/" target="_blank" rel="external">Intelligent Java IDE</a>。我们用的Android Studio就是基于这个开发的。</p>
</li>
<li><p>JDK：我这次用的是Windows系统，安装了1.8和1.7的JDK，等下写Gradle插件的时候会指定一个版本的JDK。至于指定哪个版本的JDK，会遇到什么问题，我会在后面提到。不过不管你使用什么版本的JDK，必须用交叉编译选项来编译我们的插件，以保证别人能在低版本的JDK上运行我们的插件。交叉编译选项我会在build.gradle文件中会特别标注一下。 <strong>注意</strong> ，JDK必须要安装，Groovy最后也要compile成Jar包。</p>
</li>
<li><p>Gradle：一般我们用Android Studio开发的时候都已经配置好了这个。我是让它翻墙自己下载的，下载后的目录都在C盘的Users目录下。例如我的<code>GRADLE_HOME</code>是<code>C:\Users\noughtchen\.gradle\wrapper\dists\gradle-2.4-all\6r4uqcc6ovnq6ac6s0txzcpc0\gradle-2.4</code>。为了确保你安装了Gradle并配置了环境变量，可以在命令行输入一句:</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gradle -v</div></pre></td></tr></table></figure>
<p>如果终端上显示了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">C:\Users\noughtchen&gt;gradle -v</div><div class="line"></div><div class="line">------------------------------------------------------------</div><div class="line">Gradle 2.4</div><div class="line">------------------------------------------------------------</div><div class="line"></div><div class="line">Build time:   2015-05-05 08:09:24 UTC</div><div class="line">Build number: none</div><div class="line">Revision:     5c9c3bc20ca1c281ac7972643f1e2d190f2c943c</div><div class="line"></div><div class="line">Groovy:       2.3.10</div><div class="line">Ant:          Apache Ant(TM) version 1.9.4 compiled on April 29 2014</div><div class="line">JVM:          1.7.0_80 (Oracle Corporation 24.80-b11)</div><div class="line">OS:           Windows 7 6.1 amd64</div><div class="line"></div><div class="line">C:\Users\noughtchen&gt;</div></pre></td></tr></table></figure>
<p>那就说明gradle是OK的。</p>
<ul>
<li>Groovy SDK（可跳过）：这个类似于JDK，因为Gradle插件使用Groovy语言编写，所以我们也可以安装Groovy SDK。这里是官方的<a href="http://www.groovy-lang.org/install.html#_installation_on_windows" target="_blank" rel="external">安装教程</a>，非常简单。分为三步：<ul>
<li>下载一个<a href="http://www.groovy-lang.org/install.html#download-groovy" target="_blank" rel="external">Binary Release</a>版的zip包，解压到你本地的一个目录下，例如我本地是<code>D:\mydev\groovy-2.4.5</code>。</li>
<li>添加名为<code>GROOVY_HOME</code>的环境变量，它的值为刚才的目录<code>D:\mydev\groovy-2.4.5</code>。</li>
<li>然后将<code>GROOVY_HOME/bin</code>添加到系统的环境变量<code>Path</code>里，添加的值为<code>%GROOVY_HOME%\bin</code>。</li>
</ul>
</li>
</ul>
<h2 id="Groovy基础"><a href="#Groovy基础" class="headerlink" title="Groovy基础"></a>Groovy基础</h2><p>这里可以忽略，只要懂Java和一点基本Groovy语法就行，实际上我只是在打包我们SDK项目的时候自学了一点，另外参考了一下Google官方的Gradle插件就够了，实在不会的可以再去查看Gradle官方的Document。下面是几个可以学习的资源：</p>
<ul>
<li><a href="http://tools.android.com/build/gradleplugin" target="_blank" rel="external">http://tools.android.com/build/gradleplugin</a> 这里介绍了怎么从Google Checkout下来官方的Gradle插件源码，以及Android Studio的源码！开源万岁，真是碉堡，推荐大家看一下这个，这样就知道APK是怎么打包的了。</li>
<li><a href="https://docs.gradle.org/current/userguide/custom_plugins.html" target="_blank" rel="external">https://docs.gradle.org/current/userguide/custom_plugins.html</a> Gradle官方的自定义插件文档，这篇是必看的，非常简单的HelloWorld例子。看完肯定还是不会写Gradle插件的，呵呵！</li>
</ul>
<h1 id="自定义Gradle-Plugin"><a href="#自定义Gradle-Plugin" class="headerlink" title="自定义Gradle Plugin"></a>自定义Gradle Plugin</h1><p>不废话了，下面进入正式的开发过程，这次我们在前面<a href="http://unclechen.github.io/2015/10/25/Gradle%E5%AE%9E%E8%B7%B5%E4%B9%8B%E6%89%93%E5%8C%85jar+Log%E5%BC%80%E5%85%B3%E8%87%AA%E5%8A%A8%E5%85%B3%E9%97%AD/">Gradle实践之自定义打包jar+Log开关自动关闭</a>的基础上，把打包Jar、混淆Jar包的任务都丢到插件里，然后呢，我们这次自己写JavaCompile任务，这样一来，如果是做SDK开发的同学，实际上几乎就可以不用<code>com.android.library</code>插件了，当然我个人觉得吧，能不重复造轮子就不要重复造了，等下会大家看到这点的。</p>
<h2 id="1-新建一个Groovy工程"><a href="#1-新建一个Groovy工程" class="headerlink" title="1.新建一个Groovy工程"></a>1.新建一个Groovy工程</h2><p>如下图所示，我新建了一个名为<code>HelloGradlePlugin</code>的文件夹。</p>
<p><img src="/content/images/new-a-plugin-folder.png" alt="New a groovy folder"></p>
<p>接着在文件夹里新建了一个名为<code>build.gradle</code>的文件，里面现在没有任何代码。</p>
<p><img src="/content/images/new-a-gradle-file.png" alt="New a gradle file"></p>
<p>这里有点奇怪吗？是的，为啥不是用AS直接new一个project？前面说了，AS默认新建的只能选择Android Project，下面我们看看怎么使用这一步建立的文件夹。</p>
<h2 id="2-建立项目结构"><a href="#2-建立项目结构" class="headerlink" title="2.建立项目结构"></a>2.建立项目结构</h2><p>打开Android Studio，选择<code>File-&gt;Open</code>，打开刚才这个文件夹。如图所示：</p>
<p><img src="/content/images/open-the-plugin.png" alt="Open the plugin project"></p>
<p>这时AS会提示我们是否使用本地的<code>Gradle Wrapper</code>，点击<code>yes</code>，AS会帮我们在<code>HelloGradlePlugin</code>文件夹下面自动生成对应的gradle文件夹和文件。</p>
<p><img src="/content/images/use-your-gradle-wrapper.png" alt="use-your-gradle-wrapper"></p>
<p>这样，我们就算在AS中导入我们的Gradle Plugin工程了。下面我们建立项目结构。</p>
<p>首先，在<code>src</code>文件夹下面分别建立<code>main/groovy/</code>文件夹和<code>resources/META-INF/gradle-plugins</code>。</p>
<p><img src="/content/images/create-folders.png" alt="create-folders"></p>
<p>然后，在<code>src/main/resources/META-INF/gradle-plugins</code>文件夹下面新建一个<code>hello-world-plugin.properties</code>文件，这个文件的名字就是我们就是我们这个Gradle插件的名字(即<code>name</code>)，将来在其他项目中引用这个插件的时候，就需要指定为这个名字，在最后面会详细介绍这个<code>name</code>是怎么用的。</p>
<p>接着需要在这个文件中添加一行代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">implementation-class = com.nought.gradle.plugin.HelloPlugin</div></pre></td></tr></table></figure>
<p>意思是我们的插件名字叫<code>hello-world-plugin</code>，实现这个插件功能的类名为<code>HelloPlugin</code>。</p>
<p>在实现<code>helloPlugin</code>这个类之前，我们先给这个Project添加一下依赖，因为我们最开始是通过新建文件夹的形式，然后在AS中导入这个项目，所以它还没有把groovy相关的包依赖进来。我们在项目名字上右键，选择<code>Open Module Settings</code>，然后添加Dependencies，如下图所示：</p>
<p><img src="/content/images/add-groovy-sdk.png" alt="add-groovy-sdk"></p>
<p>最后，我们在<code>src/main/groovy</code>下面新建一个一个名为<code>com.nought.gradle.plugin</code>的package。</p>
<p><img src="/content/images/new-class-folder.png" alt="new-class-folder"></p>
<p>并在这个包下建立名为<code>HelloPlugin</code>的类(右键<code>new file</code>-&gt;输入<code>HelloPlugin.groovy</code>)。</p>
<p>下面开始写代码，我们通过自己定义一个插件，来实现前一篇博客里面的gradle打包功能，它可以把我们指定的java代码打包成jar包，并按照配置决定是否进行混淆，并输出到一个指定的文件夹中。</p>
<h2 id="3-实现Plugin接口"><a href="#3-实现Plugin接口" class="headerlink" title="3.实现Plugin接口"></a>3.实现Plugin接口</h2><p>定义了<code>HelloPlugin</code>类，我们要让它实现Plugin接口，并实现其中的<code>apply</code>方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">package com.nought.gradle.plugin</div><div class="line"></div><div class="line">import org.gradle.api.Plugin</div><div class="line">import org.gradle.api.Project</div><div class="line"></div><div class="line"></div><div class="line">class HelloPlugin implements Plugin&lt;Project&gt; &#123;</div><div class="line">    @Override</div><div class="line">    void apply(Project project) &#123;</div><div class="line">	...</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="4-定义Extension"><a href="#4-定义Extension" class="headerlink" title="4.定义Extension"></a>4.定义Extension</h2><p>首先，什么是Extension？</p>
<p>Extension就是扩展属性，指的是你可以给你的project添加额外的gradle约定之外的其他properties属性。我们在Android项目里的<code>build.gradle</code>文件中通常使用的诸如下面这种代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    compileSdkVersion 22</div><div class="line">    buildToolsVersion &quot;22.0.1&quot;</div><div class="line">	...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>就是在给Android插件的Extension的<code>compileSdkVersion</code>和<code>buildToolsVersion</code>赋值。我们自己写一个插件，也要实现同样的效果。只要在gradle文件里apply了我们的自定义的插件，我们就可以给自定义的插件赋予额外的属性，并在插件里用到它们，例如你打一个jar包时可以把输出文件存放地址传入进去等等。</p>
<p>So，新建一个名为<code>HelloPluginExtension</code>的类，表明这是<code>HelloPlugin</code>的扩展属性。并在这个类里面添加一些<code>String</code>类型的变量，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">package com.nought.gradle.plugin</div><div class="line"></div><div class="line">class HelloPluginExtension &#123;</div><div class="line">    String javaSrcDir // java源码的目录</div><div class="line">    String classesOutDir // 编译输出的class文件目录</div><div class="line"></div><div class="line">    String outputFileDir // 输出的jar包目录</div><div class="line">    String outputFileName // 输出的jar包文件名</div><div class="line"></div><div class="line">    String androidJarDir</div><div class="line">    String javaBase</div><div class="line">    String javaRt</div><div class="line"></div><div class="line">    String proguardConfigFile</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>很显然，其实你可输入任何Java语言中的变量类型。这些属性在apply我们的插件时，都可以在build.gradle脚本中传入。</p>
<h2 id="5-在Plugin中增加自定义的task"><a href="#5-在Plugin中增加自定义的task" class="headerlink" title="5.在Plugin中增加自定义的task"></a>5.在Plugin中增加自定义的task</h2><p>刚才定义了Extension里面的一些属性，自定义Gradle Plugin的框架就基本是这样了，当然你要是只写一个 <strong>helloworld</strong> demo尝尝口味，那就没必要干下面的事情了。</p>
<p>接下来我们要在<code>HelloPlugin</code>中用到这个属性，并增加一些实现了不同功能的tasks。</p>
<p>本例子中，我们自定义的插件可以编译Java源代码，并把生成的class文件打包成jar，再根据需求决定是不是混淆它。下面直接上代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div></pre></td><td class="code"><pre><div class="line">package com.nought.gradle.plugin</div><div class="line"></div><div class="line">import org.gradle.api.JavaVersion</div><div class="line">import org.gradle.api.Plugin</div><div class="line">import org.gradle.api.Project</div><div class="line">import org.gradle.api.tasks.Copy</div><div class="line">import org.gradle.api.tasks.bundling.Jar</div><div class="line">import org.gradle.api.tasks.compile.JavaCompile</div><div class="line">import proguard.gradle.ProGuardTask</div><div class="line"></div><div class="line">class HelloPlugin implements Plugin&lt;Project&gt; &#123;</div><div class="line"></div><div class="line">    static final String PLUGIN_NAME = &quot;helloPlugin&quot;</div><div class="line"></div><div class="line">    Project project</div><div class="line">    HelloPluginExtension extension</div><div class="line"></div><div class="line">    JavaCompile compileJavaSrc</div><div class="line">    Jar jarLib</div><div class="line">    ProGuardTask proguardLib</div><div class="line">    Copy copyLib</div><div class="line"></div><div class="line">    @Override</div><div class="line">    void apply(Project project) &#123;</div><div class="line">        this.project = project</div><div class="line">        this.extension = project.extensions.create(PLUGIN_NAME, HelloPluginExtension)</div><div class="line"></div><div class="line">        project.afterEvaluate &#123;</div><div class="line">            createSomeTasks()</div><div class="line">            // 如果是执行packageProguardJar任务，那么要提前关闭log开关</div><div class="line">            if (&apos;packageProguardJar&apos; in project.gradle.startParameter.taskNames) &#123;</div><div class="line">                project.tasks.getByName(&quot;preBuild&quot;).doFirst &#123;</div><div class="line">                    enableLoggerDebug(false)</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void createSomeTasks() &#123;</div><div class="line">        // Create a task to compile all java sources.</div><div class="line">        compileJavaSrc = project.tasks.create(&quot;compileJava&quot;, JavaCompile);</div><div class="line">        compileJavaSrc.setDescription(&quot;编译java源代码&quot;)</div><div class="line">        compileJavaSrc.source = extension.javaSrcDir</div><div class="line">        compileJavaSrc.include(&quot;com/nought/hellolib/**&quot;)</div><div class="line">        compileJavaSrc.classpath = project.files([extension.androidJarDir + &quot;/android.jar&quot;, extension.javaBase + &quot;/&quot; + extension.javaRt])</div><div class="line">        compileJavaSrc.destinationDir = project.file(extension.classesOutDir)</div><div class="line">        compileJavaSrc.sourceCompatibility = JavaVersion.VERSION_1_7</div><div class="line">        compileJavaSrc.targetCompatibility = JavaVersion.VERSION_1_7</div><div class="line">        compileJavaSrc.options.encoding = &quot;UTF-8&quot;</div><div class="line">        compileJavaSrc.options.debug = false</div><div class="line">        compileJavaSrc.options.verbose = false</div><div class="line"></div><div class="line">        // Create a task to jar the classes.</div><div class="line">        jarLib = project.tasks.create(&quot;jarLib&quot;, Jar);</div><div class="line">        jarLib.setDescription(&quot;将class文件打包成jar&quot;)</div><div class="line">        jarLib.dependsOn compileJavaSrc</div><div class="line">        jarLib.archiveName = &quot;helloLib.jar&quot;</div><div class="line">        jarLib.from(extension.classesOutDir)</div><div class="line">        jarLib.destinationDir = project.file(extension.outputFileDir)</div><div class="line">        jarLib.exclude(&quot;com/nought/hellolib/BuildConfig.class&quot;)</div><div class="line">        jarLib.exclude(&quot;com/nought/hellolib/BuildConfig\$*.class&quot;)</div><div class="line">        jarLib.exclude(&quot;**/R.class&quot;)</div><div class="line">        jarLib.exclude(&quot;**/R\$*.class&quot;)</div><div class="line">        jarLib.include(&quot;com/nought/hellolib/*.class&quot;)</div><div class="line"></div><div class="line">        // Create a task to proguard the jar.</div><div class="line">        proguardLib = project.tasks.create(&quot;proguardLib&quot;, ProGuardTask);</div><div class="line">        proguardLib.setDescription(&quot;混淆jar包&quot;)</div><div class="line">        proguardLib.dependsOn jarLib</div><div class="line">        proguardLib.injars(extension.outputFileDir + &quot;/&quot; + &quot;helloLib.jar&quot;)</div><div class="line">        proguardLib.outjars(extension.outputFileDir + &quot;/&quot; + extension.outputFileName)</div><div class="line">        proguardLib.libraryjars(extension.androidJarDir + &quot;/android.jar&quot;)</div><div class="line">        proguardLib.libraryjars(extension.javaBase + &quot;/&quot; + extension.javaRt)</div><div class="line">        proguardLib.configuration(extension.proguardConfigFile)</div><div class="line">        proguardLib.printmapping(extension.outputFileDir + &quot;/&quot; + &quot;helloLib.mapping&quot;)</div><div class="line"></div><div class="line">        // Create a task to copy the jar.</div><div class="line">        copyLib = project.tasks.create(&quot;copyLib&quot;, Copy);</div><div class="line">        copyLib.setDescription(&quot;不混淆，仅拷贝jar包&quot;)</div><div class="line">        copyLib.dependsOn jarLib</div><div class="line">        copyLib.from(extension.outputFileDir)</div><div class="line">        copyLib.into(extension.outputFileDir)</div><div class="line">        copyLib.include(&quot;helloLib.jar&quot;)</div><div class="line">        copyLib.rename(&quot;helloLib.jar&quot;, extension.outputFileName)</div><div class="line"></div><div class="line">        def packageProguardJar = project.tasks.create(&quot;packageProguardJar&quot;);</div><div class="line">        packageProguardJar.setDescription(&quot;打包混淆、关闭log开关的hello lib&quot;)</div><div class="line">        // packageProguardJar任务作为一个钩子，依赖真正执行工作的proguardLib</div><div class="line">        packageProguardJar.dependsOn proguardLib</div><div class="line">        // 最后把log开关置回原来开发时的状态</div><div class="line">        packageProguardJar.doLast &#123;</div><div class="line">            enableLoggerDebug(true)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        def packageNoProguardJar = project.tasks.create(&quot;packageNoProguardJar&quot;);</div><div class="line">        packageNoProguardJar.setDescription(&quot;打包不混淆、开启log开关的hello lib&quot;)</div><div class="line">        // packageNoProguardJar任务作为一个钩子，依赖真正执行工作的copyLib</div><div class="line">        packageNoProguardJar.dependsOn copyLib</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    // 开启/关闭Log开关</div><div class="line">    def enableLoggerDebug(boolean flag) &#123;</div><div class="line">        def loggerFilePath = &quot;src/main/java/com/nought/hellolib/UncleNought.java&quot;</div><div class="line">        def updatedDebug = new File(loggerFilePath).getText(&apos;UTF-8&apos;)</div><div class="line">                .replaceAll(&quot;ENABLE_DEBUG\\s?=\\s?&quot; + (!flag).toString(), &quot;ENABLE_DEBUG = &quot; + flag.toString())</div><div class="line">        new File(loggerFilePath).write(updatedDebug, &apos;UTF-8&apos;)</div><div class="line">        println(flag ? &apos;ENABLE_DEBUG : [true]&apos; : &apos;ENABLE_DEBUG : [false]&apos;)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码不多，其实就是创建了4个task，彼此之间有依赖，最后再创建两个钩子任务，他们不做实际的工作，只是通过钩子任务去依赖真正实现了功能的task。大家如果看过Android Gradle Plugin的实现，就知道assembleXXX任务就是这么干的。</p>
<h2 id="6-发布插件"><a href="#6-发布插件" class="headerlink" title="6.发布插件"></a>6.发布插件</h2><p>为了让其他的项目能引用这个打包插件，需要将这个插件发布出去，我们在插件项目的根目录下的<code>build.gradle</code>文件。添加下面的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">apply plugin: &apos;groovy&apos;</div><div class="line">apply plugin: &apos;maven&apos;</div><div class="line"></div><div class="line">version = &apos;1.0.0&apos;</div><div class="line">group = &apos;com.nought.gradle.plugin&apos;</div><div class="line">archivesBaseName = &apos;hello-gradle-plugin&apos;</div><div class="line"></div><div class="line">repositories &#123;</div><div class="line">    mavenCentral()</div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    compile gradleApi()</div><div class="line">    compile localGroovy()</div><div class="line">    compile files(&apos;libs/proguard.jar&apos;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 一定要记得使用交叉编译选项，因为我们可能用很高的JDK版本编译，为了让安装了低版本的同学能用上我们写的插件，必须设定source和target</div><div class="line">compileGroovy &#123;</div><div class="line">    sourceCompatibility = 1.7</div><div class="line">    targetCompatibility = 1.7</div><div class="line">    options.encoding = &quot;UTF-8&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">uploadArchives &#123;</div><div class="line">    repositories.mavenDeployer &#123;</div><div class="line">// 如果你公司或者自己搭了nexus私服，那么可以将插件deploy到上面去</div><div class="line">//        repository(url: &quot;http://10.XXX.XXX.XXX:8080/nexus/content/repositories/releases/&quot;) &#123;</div><div class="line">//            authentication(userName: &quot;admin&quot;, password: &quot;admin&quot;)</div><div class="line">//        &#125;</div><div class="line">// 如果没有私服的话，发布到本地也是ok的</div><div class="line">        repository(url: &apos;file:release/libs&apos;)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的代码就是通过<code>groovy</code>插件编译打包我们的插件代码，并通过<code>maven</code>插件publish到指定的服务器。我们为了调试，先将插件发布到本地的<code>release/libs</code>文件夹下面就行。</p>
<h2 id="7-在自己项目中应用写好的插件"><a href="#7-在自己项目中应用写好的插件" class="headerlink" title="7.在自己项目中应用写好的插件"></a>7.在自己项目中应用写好的插件</h2><p>现在假设我们把刚才的插件打包，发布到了<code>release/libs</code>下面。这时属于本地的发布和引用，我们可以将这个libs下面的文件夹全部拷贝到自己的Android项目根目录的<code>libs</code>下面去，一般可能Android项目下的根目录中没有这个文件夹，那么我们就新建一个<code>libs</code>，再把gradle插件的文件夹全部丢进去。以前一篇博客的Android工程为例。</p>
<p>首先在项目根目录的<code>build.gradle</code>文件中按照下面的方式引用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">        maven &#123;</div><div class="line">// 假如你有私服可以用的话，可以引用私服</div><div class="line">// url &apos;http://10.XXX.XXX.XXX:8080/nexus/content/repositories/releases/&apos;</div><div class="line">// 没有的话，就本地引入</div><div class="line">            url &apos;libs&apos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath &apos;com.android.tools.build:gradle:1.3.0&apos;</div><div class="line">		// 自定义的插件以 groupId:name:版本号 的方式引用，这个name来自插件工程下的hello-world-plugin.properties文件名</div><div class="line">        classpath &apos;com.nought.gradle.plugin:hello-gradle-plugin:1.0.0&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">        maven &#123;</div><div class="line">// 假如你有私服可以用的话，可以引用私服</div><div class="line">// url &apos;http://10.XXX.XXX.XXX:8080/nexus/content/repositories/releases/&apos;</div><div class="line">// 没有的话，就本地引入，这里是给subProject设置，和上面类似</div><div class="line">            url &apos;libs&apos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在需要使用自定义插件的Module中apply这个插件。并将该自定义插件的Extension传入进去，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">apply plugin: &apos;com.android.library&apos;</div><div class="line">apply plugin: &apos;hello-gradle-plugin&apos;</div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion 22</div><div class="line">    buildToolsVersion &quot;22.0.1&quot;</div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        minSdkVersion 14</div><div class="line">        targetSdkVersion 22</div><div class="line">        versionCode 1</div><div class="line">        versionName &quot;1.0&quot;</div><div class="line">    &#125;</div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            buildConfigField &quot;boolean&quot;, &quot;ENABLE_DEBUG&quot;, &quot;false&quot;</div><div class="line">            minifyEnabled false</div><div class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</div><div class="line">        &#125;</div><div class="line">        debug &#123;</div><div class="line">            buildConfigField &quot;boolean&quot;, &quot;ENABLE_DEBUG&quot;, &quot;true&quot;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    compile fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])</div><div class="line">&#125;</div><div class="line"></div><div class="line">helloPlugin &#123;</div><div class="line">    javaSrcDir = &apos;src/main/java&apos;</div><div class="line">    classesOutDir = &apos;build/out_classes&apos;</div><div class="line"></div><div class="line">    outputFileDir = &apos;release&apos;</div><div class="line">    outputFileName = &apos;helloLib-release.jar&apos;</div><div class="line"></div><div class="line">    // Android SDK Dir</div><div class="line">    androidJarDir = android.getSdkDirectory().toString() + &quot;/platforms/&quot; + &quot;$&#123;android.compileSdkVersion&#125;&quot;</div><div class="line"></div><div class="line">    // JAVA HOME</div><div class="line">    javaBase = System.properties[&quot;java.home&quot;]</div><div class="line">    javaRt = &quot;/lib/rt.jar&quot;</div><div class="line">    if (System.properties[&quot;os.name&quot;].toLowerCase().contains(&quot;mac&quot;)) &#123;</div><div class="line">        if (!new File(javaBase + javaRt).exists()) &#123;</div><div class="line">            javaRt = &quot;/../Classes/classes.jar&quot;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    proguardConfigFile = &apos;proguard-rules.pro&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这时我们的Android工程下的gradle打包脚本就干净多了，所有的任务都丢到自定义的插件里面去了。需要动态指定的属性，通过Extension就可以进行赋值，非常方便。</p>
<p>当需要打包时，打开Android Studio自带的终端，输入<code>cd hellolib</code>进入lib工程的目录，再输入<code>gradle packageProguardJar</code>或者<code>gradle packageNoProguardJar</code>就可以打包了。打包出来的jar怎么给app module去引用，就不赘述了。</p>
<p>你甚至可以在自己的Gradle插件里再写一个copy task，直接将打好的helloLib.jar拷贝到app目录的libs下面，这样就更方便了。另外，app module下的版本号管理任务，你也可以把他们丢到自定义的插件里面去，如果你的生成环境要求你的Android工程尽可能简洁时，建议大家都封装一个自己的打包插件，deploy到公司的maven私服去。</p>
<p>最后贴上<a href="https://github.com/unclechen/HelloGradlePlugin" target="_blank" rel="external">Gradle插件工程</a>和引用插件工程打包的<a href="https://github.com/unclechen/HelloGradle" target="_blank" rel="external">Android工程</a>供参考。</p>
<h1 id="容易遇到的问题"><a href="#容易遇到的问题" class="headerlink" title="容易遇到的问题"></a>容易遇到的问题</h1><h2 id="遇到Unsupported-major-minor-version-52-0问题"><a href="#遇到Unsupported-major-minor-version-52-0问题" class="headerlink" title="遇到Unsupported major.minor version 52.0问题"></a>遇到<code>Unsupported major.minor version 52.0</code>问题</h2><p>这个前面我提过，在插件工程的打包脚本中，有一个交叉编译选项，如果你使用高版本的JDK编写Gradle插件，为了让你打出来的Gradle Plugin（实际上就是一个jar包），能在别人低版本的JRE上跑起来，你就必须使用这个选项。否则，人家还要去安装一个新的JDK，就很蛋疼了。</p>
<p>请记得加上这个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"></div><div class="line">compileGroovy &#123;</div><div class="line">    sourceCompatibility = 1.7</div><div class="line">    targetCompatibility = 1.7</div><div class="line">    options.encoding = &quot;UTF-8&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">...</div></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
            <a href="/tags/打包/" rel="tag"># 打包</a>
          
            <a href="/tags/gradle/" rel="tag"># gradle</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/10/25/Gradle实践之打包jar+Log开关自动关闭/" rel="next" title="Gradle实践之自定义打包jar+Log开关自动关闭">
                <i class="fa fa-chevron-left"></i> Gradle实践之自定义打包jar+Log开关自动关闭
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/11/26/Android WebView调用JS/" rel="prev" title="Android WebView调用JS">
                Android WebView调用JS <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="unclechen" />
          <p class="site-author-name" itemprop="name">unclechen</p>
           
              <p class="site-description motion-element" itemprop="description">吃下恶魔果实，我就能变成超级赛亚人！</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#准备工作"><span class="nav-number">1.</span> <span class="nav-text">准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#开发环境（以Win7为例）"><span class="nav-number">1.1.</span> <span class="nav-text">开发环境（以Win7为例）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Groovy基础"><span class="nav-number">1.2.</span> <span class="nav-text">Groovy基础</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#自定义Gradle-Plugin"><span class="nav-number">2.</span> <span class="nav-text">自定义Gradle Plugin</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-新建一个Groovy工程"><span class="nav-number">2.1.</span> <span class="nav-text">1.新建一个Groovy工程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-建立项目结构"><span class="nav-number">2.2.</span> <span class="nav-text">2.建立项目结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-实现Plugin接口"><span class="nav-number">2.3.</span> <span class="nav-text">3.实现Plugin接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-定义Extension"><span class="nav-number">2.4.</span> <span class="nav-text">4.定义Extension</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-在Plugin中增加自定义的task"><span class="nav-number">2.5.</span> <span class="nav-text">5.在Plugin中增加自定义的task</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-发布插件"><span class="nav-number">2.6.</span> <span class="nav-text">6.发布插件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-在自己项目中应用写好的插件"><span class="nav-number">2.7.</span> <span class="nav-text">7.在自己项目中应用写好的插件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#容易遇到的问题"><span class="nav-number">3.</span> <span class="nav-text">容易遇到的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#遇到Unsupported-major-minor-version-52-0问题"><span class="nav-number">3.1.</span> <span class="nav-text">遇到Unsupported major.minor version 52.0问题</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">unclechen</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
